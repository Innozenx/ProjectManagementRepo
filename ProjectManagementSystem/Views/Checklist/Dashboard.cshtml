@model ProjectManagementSystem.Models.DashboardViewModel
@using System.Globalization;
@{
    ViewBag.Title = "Dashboard";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<style>
    .dashboard-container {
        padding: 10px;
        margin-left: 160px;
    }

    .card {
        border-radius: 25px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        border: none;
    }

    .card-success {
        background-color: #4CAF50;
    }

    .card-warning {
        background-color: #FFC107;
    }

    .card-info {
        background-color: #673AB7;
    }

    .card-primary {
        background-color: #9C27B0;
    }

    .card-body {
        padding: 15px;
        color: #fff;
    }

    .card-title {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 15px;
    }

    .card-text {
        font-size: 1.75rem;
    }

    .row {
        margin-top: 20px;
    }

    h2 {
        font-size: 2.5rem;
        margin-bottom: 40px;
        text-align: center;
        color: #4A148C;
    }

    h4 {
        font-size: 2rem;
        margin-bottom: 30px;
        color: #311B92;
    }

    .table-container {
        overflow-x: auto;
        white-space: nowrap;
    }

    .table th, .table td {
        padding: 12px;
        text-align: center;
        border: 2px solid #D1C4E9;
    }

    .table th {
        background-color: #66339A;
        color: #fff;
    }

    .table td {
        background-color: #EDE7F6;
        color: #333;
    }

    .table tr:nth-child(even) {
        background-color: #D1C4E9;
    }

    th, td {
        border: 1px solid #ddd;
        padding: 8px;
        min-width: 150px;
    }

        td:first-child, th:first-child {
            position: -webkit-sticky;
            position: sticky;
            left: 0;
            z-index: 2;
            border-right: 2px solid #ddd;
        }

    .sticky-col {
        position: -webkit-sticky;
        position: sticky;
    }

    .first-col {
        width: 300px;
        min-width: 300px;
        max-width: 300px;
        left: 0px;
    }

    .fifth-col {
        display: none;
    }

    /* DataTables specific styles */
    .dataTables_wrapper .dataTables_paginate .paginate_button {
        padding: 0.5em;
    }

        .dataTables_wrapper .dataTables_paginate .paginate_button.current {
            background-color: #4CAF50;
            color: white;
        }

    .dataTables_wrapper .dataTables_filter input {
        margin: 0.5em;
    }

    .dataTables_wrapper .dataTables_info {
        margin: 0.5em;
    }
</style>

<!-- Content Header (Page header) -->
<div class="content-header">
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-6">
                <h1 class="m-0">@ViewBag.Title</h1>
                <h5 class="text-muted">
                    @DateTime.Now.ToString("MMMM dd, yyyy h:mm tt")
                </h5>
            </div><!-- /.col -->
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="@Url.Action("Dashboard", "Checklist")">Home</a></li>
                    <li class="breadcrumb-item active">Dashboard</li>
                    @*<li class="breadcr7j-tem active">Dashboard</li>*@

                </ol>
            </div><!-- /.col -->
        </div><!-- /.row -->
    </div><!-- /.container-fluid -->
</div>
<!-- /.content-header -->
<!-- Main content -->
<div class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3">
                <div class="card card-success h-100">
                    <div class="card-body">
                        <h3 class="card-title">@Model.CompletedTasks</h3>
                        <p class="card-text">Completed Tasks</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card card-warning h-100">
                    <div class="card-body">
                        <h3 class="card-title">@Model.PendingTasks</h3>
                        <p class="card-text">Pending Tasks</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card card-info h-100">
                    <div class="card-body">
                        <h3 class="card-title">@Model.TotalTasks</h3>
                        <p class="card-text">Total Tasks</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card card-primary h-100">
                    <div class="card-body">
                        <h3 class="card-title">Week @Model.CurrentWeek</h3>
                        <p class="card-text">Current Week</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- table -->
        <div class="row">
            <div class="col-lg-12">
                <div class="table-container" style="overflow:auto">
                    <table id="milestonesTable" class="display">
                        <thead>
                            <tr>
                                <th>Project Title</th>
                                @foreach (var milestoneName in Model.UniqueMilestoneNames)
                                {
                                    <th>@milestoneName</th>


                                  
                                }
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var projectGroup in Model.ProjectsMilestones.GroupBy(pm => pm.ProjectTitle))
                            {
                                <tr>
                                    <td>
                                        <a href="javascript:void(0);" onclick="toDetailedView('@projectGroup.Key', '@projectGroup.Key', '@projectGroup.Key')">
                                            @projectGroup.Key
                                        </a>
                                    </td>
                                    @foreach (var milestoneName in Model.UniqueMilestoneNames)
                                    {
                                        var milestone = projectGroup.FirstOrDefault(pm => pm.MilestoneName == milestoneName);
                                        var bgColor = "transparent";

                                        if (milestone != null && milestone.EndDate.HasValue)
                                        {
                                            var endWeekNumber = CultureInfo.InvariantCulture.Calendar.GetWeekOfYear(milestone.EndDate.Value, CalendarWeekRule.FirstFourDayWeek, DayOfWeek.Sunday);
                                            var currentWeek = Model.CurrentWeek;

                                            bgColor = endWeekNumber < currentWeek && milestone.EndDate.HasValue ? "red"
                                                       : endWeekNumber > currentWeek ? "white"
                                                       : "green"; 
                                        }

                                        <td class="week-cell" style="background-color:@bgColor" onclick="toDetailedView('@projectGroup.Key', '@milestoneName', 'week-@milestoneName')">
                                            @(milestone != null ? milestone.EndDateFormat : "N/A")
                                        </td>

                                   
                                    }
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- /.container-fluid -->
</div>
<!-- /.content -->
@section scripts{
    <!-- jQuery -->
    <script src="~/AdminLTE-3.2.0/plugins/jquery/jquery.min.js"></script>
    <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#milestonesTable').DataTable({
                "paging": true,
                "searching": true,
                "info": true,
                "autoWidth": false,
                "columnDefs": [
                    { "targets": "_all", "className": "dt-center" }
                ]
            });
        });

     function toDetailedView(value, id, name) {
            var url = "@Url.Action("weeklyMilestone", "Checklist")";
            var queryString = $.param({
                id: value,
                title: id,
                projectId: name
            });
            window.location.href = url + "?" + queryString;
    }
    </script>
}
