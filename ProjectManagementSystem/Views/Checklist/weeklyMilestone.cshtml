@model ProjectManagementSystem.Models.exportCSV
@{
    ViewBag.Title = "Milestone";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<style>
    #gantt_here {
        width: calc(100% - 160px);
        height: 85vh;
        border-radius: 10px;
        overflow: hidden;
    }

    .view-controls {
        margin: 20px 0;
        text-align: left;
    }

        .view-controls button {
            background-color: #66339A;
            border: none;
            color: yellow;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 25px;
            cursor: pointer;
            transition: background-color 0.3s, box-shadow 0.3s;
        }

            .view-controls button:hover {
                background-color: #4a1a72;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            }

    .table-container {
        margin: 20px 0;
        padding: 10px;
        background-color: #f4f4f4;
        border-radius: 10px;
    }

    h1 {
        font-weight: bold;
        color: #66399A;
    }
</style>

<div class="table-container">
    <h1>Project Details</h1>
    <table id="projectDetails" class="table">
        <thead>
            <tr>
                <th>Project Title</th>
                <th>Project Start</th>
                <th>Project End</th>
                <th>Duration</th>
                <th>Year</th>
                <th>Division</th>
                <th>Category</th>
                <th>Project Owner</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var project in Model.ProjectDetails)
            {
                <tr>
                    <td>
                        <a href="@Url.Action("weeklyMilestone", "Checklist", new { id = project.id, title = project.ProjectTitle, projectId = project.DetailsID })">
                            @project.ProjectTitle
                        </a>
                    </td>
                    <td>@DateTime.Parse(project.projectStart).ToString("MMMM dd, yyyy")</td>
                    <td>@DateTime.Parse(project.projectEnd).ToString("MMMM dd, yyyy")</td>
                    <td>@project.ProjectDuration days</td>
                    <td>@project.ProjectYear</td>
                    <td>@project.division</td>
                    <td>@project.category</td>
                    <td>@project.projectOwner</td>
                </tr>
            }
        </tbody>
    </table>
</div>

<div class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <div class="view-controls">
                    <button onclick="setMonthView()">Month View</button>
                    <button onclick="setWeekView()">Week View</button>
                    <button onclick="setDayView()">Day View</button>
                </div>
                <div id="gantt_here" style="width:100%"></div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            gantt.config.xml_date = "%Y-%m-%d %H:%i";
            gantt.config.readonly = true;

            gantt.config.columns = [
                { name: "text", label: "Milestones", width: "*", tree: true },
                { name: "start_date", label: "Start Date", align: "center" },
                { name: "end_date", label: "End Date", align: "center" },
                { name: "duration", label: "Duration", align: "center" }
            ];

            gantt.config.scale_unit = "week";
            gantt.config.date_scale = "%d %M";
            gantt.config.subscales = [{ unit: "month", step: 1, date: "%M" }];
            gantt.config.scale_height = 75;

            gantt.templates.date_scale = function (date) {
                var dateToStr = gantt.date.date_to_str("%d %M");
                var endDate = gantt.date.add(gantt.date.add(date, 1, "week"), -1, "day");
                return dateToStr(date) + " - " + dateToStr(endDate);
            };

            gantt.templates.rightside_text = function (start, end, task) {
                return task.type === gantt.config.types.milestone ? task.text : "";
            };

            gantt.config.lightbox.sections = [
                { name: "description", height: 70, map_to: "text", type: "textarea", focus: true },
                { name: "type", type: "typeselect", map_to: "type" },
                { name: "time", height: 72, type: "duration", map_to: "auto" }
            ];

            gantt.plugins({ tooltip: true });
            gantt.init("gantt_here");

            gantt.load(`/Checklist/getGanttData?week=${@TempData["entry"]}&title='@TempData["title"]'&detailsId='@TempData["project"]'`, "json");


            window.setMonthView = function () {
                gantt.config.scale_unit = "month";
                gantt.config.date_scale = "%F, %Y";
                gantt.config.subscales = [{ unit: "month", step: 1, date: "%m" }];
                gantt.render();
            };

            window.setWeekView = function () {
                gantt.config.scale_unit = "week";
                gantt.config.date_scale = "%d %M";
                gantt.config.subscales = [{ unit: "week", step: 1, date: "%W" }];
                gantt.render();
            };

            window.setDayView = function () {
                gantt.config.scale_unit = "day";
                gantt.config.date_scale = "%d %M";
                gantt.config.subscales = [{ unit: "day", step: 1, date: "%d" }];
                gantt.render();
            };

            setWeekView();
        });
    </script>
}
